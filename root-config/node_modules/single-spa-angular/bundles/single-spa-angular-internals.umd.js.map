{"version":3,"file":"single-spa-angular-internals.umd.js","sources":["../../../libs/single-spa-angular/internals/src/dom.ts","../../../libs/single-spa-angular/internals/src/single-spa-angular-internals.ts"],"sourcesContent":["import { DomElementGetter, BaseSingleSpaAngularOptions } from './types';\n\nexport function removeApplicationFromDOMIfIvyEnabled<T extends BaseSingleSpaAngularOptions>(\n  options: T,\n  props: any,\n): void {\n  if (ivyEnabled()) {\n    const domElementGetter = chooseDomElementGetter(options, props);\n    const domElement = getContainerElement(domElementGetter);\n    // View Engine removes all nodes automatically when calling `NgModuleRef.destroy()`,\n    // which calls `ComponentRef.destroy()`.\n    // Basically this will remove `app-root` or any other selector from the container element.\n    while (domElement.firstChild) domElement.removeChild(domElement.firstChild);\n  }\n}\n\nexport function getContainerElementAndSetTemplate<T extends BaseSingleSpaAngularOptions>(\n  options: T,\n  props: any,\n): HTMLElement {\n  const domElementGetter = chooseDomElementGetter(options, props);\n\n  if (!domElementGetter) {\n    throw Error(\n      `Cannot mount angular application '${\n        props.name || props.appName\n      }' without a domElementGetter provided either as an opt or a prop`,\n    );\n  }\n\n  const containerElement = getContainerElement(domElementGetter);\n  containerElement.innerHTML = options.template;\n  return containerElement;\n}\n\nfunction getContainerElement(domElementGetter: DomElementGetter): never | HTMLElement {\n  const element = domElementGetter();\n\n  if (!element) {\n    throw Error('domElementGetter did not return a valid dom element');\n  }\n\n  return element;\n}\n\nfunction chooseDomElementGetter<T extends BaseSingleSpaAngularOptions>(\n  opts: T,\n  props: any,\n): DomElementGetter {\n  props = props?.customProps ?? props;\n\n  if (props.domElement) {\n    return () => props.domElement;\n  } else if (props.domElementGetter) {\n    return props.domElementGetter;\n  } else if (opts.domElementGetter) {\n    return opts.domElementGetter;\n  } else {\n    return defaultDomElementGetter(props.name);\n  }\n}\n\nfunction defaultDomElementGetter(name: string): DomElementGetter {\n  return function getDefaultDomElement() {\n    const id = `single-spa-application:${name}`;\n    let domElement: HTMLElement | null = document.getElementById(id);\n\n    if (!domElement) {\n      domElement = document.createElement('div');\n      domElement.id = id;\n      document.body.appendChild(domElement);\n    }\n\n    return domElement;\n  };\n}\n\nfunction ivyEnabled(): boolean {\n  try {\n    // `ɵivyEnabled` variable is exposed starting from version 8.\n    // We use `require` here except of a single `import { ɵivyEnabled }` because the\n    // developer can use Angular version that doesn't expose it (all versions <8).\n    // The `catch` statement will handle those cases.\n    // eslint-disable-next-line\n    const { ɵivyEnabled } = require('@angular/core');\n    return !!ɵivyEnabled;\n  } catch {\n    return false;\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":";;;;;;aAEgB,oCAAoC,CAClD,OAAU,EACV,KAAU;QAEV,IAAI,UAAU,EAAE,EAAE;YAChB,IAAM,gBAAgB,GAAG,sBAAsB,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;YAChE,IAAM,UAAU,GAAG,mBAAmB,CAAC,gBAAgB,CAAC,CAAC;;;;YAIzD,OAAO,UAAU,CAAC,UAAU;gBAAE,UAAU,CAAC,WAAW,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;SAC7E;IACH,CAAC;aAEe,iCAAiC,CAC/C,OAAU,EACV,KAAU;QAEV,IAAM,gBAAgB,GAAG,sBAAsB,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QAEhE,IAAI,CAAC,gBAAgB,EAAE;YACrB,MAAM,KAAK,CACT,wCACE,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,OACtB,sEAAkE,CACnE,CAAC;SACH;QAED,IAAM,gBAAgB,GAAG,mBAAmB,CAAC,gBAAgB,CAAC,CAAC;QAC/D,gBAAgB,CAAC,SAAS,GAAG,OAAO,CAAC,QAAQ,CAAC;QAC9C,OAAO,gBAAgB,CAAC;IAC1B,CAAC;IAED,SAAS,mBAAmB,CAAC,gBAAkC;QAC7D,IAAM,OAAO,GAAG,gBAAgB,EAAE,CAAC;QAEnC,IAAI,CAAC,OAAO,EAAE;YACZ,MAAM,KAAK,CAAC,qDAAqD,CAAC,CAAC;SACpE;QAED,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,SAAS,sBAAsB,CAC7B,IAAO,EACP,KAAU;;QAEV,KAAK,SAAG,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,WAAW,mCAAI,KAAK,CAAC;QAEpC,IAAI,KAAK,CAAC,UAAU,EAAE;YACpB,OAAO,cAAM,OAAA,KAAK,CAAC,UAAU,GAAA,CAAC;SAC/B;aAAM,IAAI,KAAK,CAAC,gBAAgB,EAAE;YACjC,OAAO,KAAK,CAAC,gBAAgB,CAAC;SAC/B;aAAM,IAAI,IAAI,CAAC,gBAAgB,EAAE;YAChC,OAAO,IAAI,CAAC,gBAAgB,CAAC;SAC9B;aAAM;YACL,OAAO,uBAAuB,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;SAC5C;IACH,CAAC;IAED,SAAS,uBAAuB,CAAC,IAAY;QAC3C,OAAO,SAAS,oBAAoB;YAClC,IAAM,EAAE,GAAG,4BAA0B,IAAM,CAAC;YAC5C,IAAI,UAAU,GAAuB,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC;YAEjE,IAAI,CAAC,UAAU,EAAE;gBACf,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;gBAC3C,UAAU,CAAC,EAAE,GAAG,EAAE,CAAC;gBACnB,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;aACvC;YAED,OAAO,UAAU,CAAC;SACnB,CAAC;IACJ,CAAC;IAED,SAAS,UAAU;QACjB,IAAI;;;;;;YAMM,IAAA,WAAW,GAAK,OAAO,CAAC,eAAe,CAAC,YAA7B,CAA8B;YACjD,OAAO,CAAC,CAAC,WAAW,CAAC;SACtB;QAAC,WAAM;YACN,OAAO,KAAK,CAAC;SACd;IACH;;ICzFA;;;;;;;;;;;;;"}